<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <assignments>
        <name>Assign_Not_Present_Fields</name>
        <label>Assign Not Present Fields</label>
        <locationX>613</locationX>
        <locationY>647</locationY>
        <assignmentItems>
            <assignToReference>WorkOrderRecord.HRCFSL_Signee_Title__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Signee_Title_Not_Present</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>WorkOrderRecord.HRCFSL_Signee_Email__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Signee_Email_Not_Present</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_service_appointment_service_note</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Work_Order_fields</name>
        <label>Assign Work Order fields</label>
        <locationX>776</locationX>
        <locationY>483</locationY>
        <assignmentItems>
            <assignToReference>WorkOrderRecord.HRCFSL_Signee_Email__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Signee_Email</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>WorkOrderRecord.HRCFSL_Signee_Title__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Signee_Title</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_Work_Order</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Update service appointment service note</description>
        <name>Update_service_appointment_service_note</name>
        <label>Update service appointment service note</label>
        <locationX>611</locationX>
        <locationY>796</locationY>
        <assignmentItems>
            <assignToReference>ServiceAppointmentRecord.ServiceNote</assignToReference>
            <operator>Add</operator>
            <value>
                <stringValue>Signee Not Available.</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_Service_appointment</targetReference>
        </connector>
    </assignments>
    <choices>
        <name>No</name>
        <choiceText>No</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>No</stringValue>
        </value>
    </choices>
    <choices>
        <name>Yes</name>
        <choiceText>Yes</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Yes</stringValue>
        </value>
    </choices>
    <decisions>
        <name>Check_Child_ERP</name>
        <label>Check Child ERP</label>
        <locationX>1242</locationX>
        <locationY>446</locationY>
        <defaultConnector>
            <targetReference>For_Each_Child</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>No_ERP_Id</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>childWorkOrder.HRCFSL_JDE_ID__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>childWorkOrder.HRCFSL_JDE_ID__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue></stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>childWorkOrder.HRCFSL_JDE_ID__c</leftValueReference>
                <operator>EqualTo</operator>
            </conditions>
            <connector>
                <targetReference>Child_Work_Order_Issue</targetReference>
            </connector>
            <label>No ERP Id</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_Status</name>
        <label>Check Status</label>
        <locationX>613</locationX>
        <locationY>177</locationY>
        <defaultConnector>
            <targetReference>Child_Work_Orders</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Status_is_not_Awaiting_Signature</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>ServiceAppointmentRecord.Status</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Awaiting signature</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>ServiceAppointmentRecord.HRCFSL_ERP_Work_Order_ID__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue></stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>ServiceAppointmentRecord.HRCFSL_ERP_Work_Order_ID__c</leftValueReference>
                <operator>EqualTo</operator>
            </conditions>
            <conditions>
                <leftValueReference>ServiceAppointmentRecord.HRCFSL_ERP_Work_Order_ID__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Screen</targetReference>
            </connector>
            <label>Status is not Awaiting Signature</label>
        </rules>
    </decisions>
    <decisions>
        <name>Has_Children</name>
        <label>Has Children?</label>
        <locationX>1008</locationX>
        <locationY>326</locationY>
        <defaultConnector>
            <targetReference>Is_Signee_Available</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Children No</defaultConnectorLabel>
        <rules>
            <name>Children_Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>childWorkOrders</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>For_Each_Child</targetReference>
            </connector>
            <label>Children Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Signee_Present</name>
        <label>Signee Present?</label>
        <locationX>466</locationX>
        <locationY>462</locationY>
        <defaultConnector>
            <targetReference>User_Input_Not_Present</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Not Present</defaultConnectorLabel>
        <rules>
            <name>Present_Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Is_SigneeAvailable</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Yes</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>User_Input</targetReference>
            </connector>
            <label>Present Yes</label>
        </rules>
    </decisions>
    <interviewLabel>HRCFSL Capture Signature {!$Flow.CurrentDateTime}</interviewLabel>
    <label>HRCFSL Capture Signature</label>
    <loops>
        <name>For_Each_Child</name>
        <label>For Each Child</label>
        <locationX>1017</locationX>
        <locationY>484</locationY>
        <assignNextValueToReference>childWorkOrder</assignNextValueToReference>
        <collectionReference>childWorkOrders</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Check_Child_ERP</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Is_Signee_Available</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>FieldServiceMobile</processType>
    <recordLookups>
        <name>Child_Work_Orders</name>
        <label>Child Work Orders</label>
        <locationX>831</locationX>
        <locationY>261</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Has_Children</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>NotEqualTo</operator>
            <value>
                <elementReference>WorkOrderRecord.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>RootWorkOrderId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>WorkOrderRecord.Id</elementReference>
            </value>
        </filters>
        <object>WorkOrder</object>
        <outputReference>childWorkOrders</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Status</queriedFields>
        <queriedFields>ParentWorkOrderId</queriedFields>
        <queriedFields>HRCFSL_JDE_ID__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Service_Appointment</name>
        <label>Get Service Appointment</label>
        <locationX>331</locationX>
        <locationY>175</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Work_Order</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Id</elementReference>
            </value>
        </filters>
        <object>ServiceAppointment</object>
        <outputReference>ServiceAppointmentRecord</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Status</queriedFields>
        <queriedFields>HRCFSL_Work_Order__c</queriedFields>
        <queriedFields>HRCFSL_ERP_Work_Order_ID__c</queriedFields>
        <queriedFields>StatusCategory</queriedFields>
        <queriedFields>ServiceNote</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Work_Order</name>
        <label>Get Work Order</label>
        <locationX>477</locationX>
        <locationY>175</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Check_Status</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>ServiceAppointmentRecord.HRCFSL_Work_Order__c</elementReference>
            </value>
        </filters>
        <object>WorkOrder</object>
        <outputReference>WorkOrderRecord</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>HRCFSL_Signee_Email__c</queriedFields>
        <queriedFields>HRCFSL_Signee_Name__c</queriedFields>
        <queriedFields>HRCFSL_Signee_Title__c</queriedFields>
        <queriedFields>ParentWorkOrderId</queriedFields>
        <queriedFields>HRCFSL_Unable_to_obtain_signature__c</queriedFields>
        <queriedFields>HRCFSL_Comments__c</queriedFields>
        <queriedFields>HRCFSL_Customer_Comments__c</queriedFields>
    </recordLookups>
    <recordUpdates>
        <description>Update Service appointment</description>
        <name>Update_Service_appointment</name>
        <label>Update Service appointment</label>
        <locationX>761</locationX>
        <locationY>796</locationY>
        <connector>
            <targetReference>Update_Work_Order</targetReference>
        </connector>
        <inputReference>ServiceAppointmentRecord</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Work_Order</name>
        <label>Update Work Order</label>
        <locationX>776</locationX>
        <locationY>658</locationY>
        <inputReference>WorkOrderRecord</inputReference>
    </recordUpdates>
    <screens>
        <name>Child_Work_Order_Issue</name>
        <label>Child Work Order Issue</label>
        <locationX>1217</locationX>
        <locationY>228</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>Check_Child_ERP</targetReference>
        </connector>
        <fields>
            <name>Display_Message2</name>
            <fieldText>&lt;p&gt;One of the child Work Orders does not have an ERP Work Order Id yet, so you cannot capture a signature.&lt;/p&gt;&lt;p&gt;Please click the x to exit the flow.&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>Is_Signee_Available</name>
        <label>Is Signee Available?</label>
        <locationX>622</locationX>
        <locationY>352</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>Signee_Present</targetReference>
        </connector>
        <fields>
            <name>Is_SigneeAvailable</name>
            <choiceReferences>Yes</choiceReferences>
            <choiceReferences>No</choiceReferences>
            <dataType>String</dataType>
            <defaultSelectedChoiceReference>Yes</defaultSelectedChoiceReference>
            <fieldText>Is Signee Available?</fieldText>
            <fieldType>RadioButtons</fieldType>
            <isRequired>false</isRequired>
        </fields>
        <fields>
            <name>Message</name>
            <fieldText>&lt;p&gt;&lt;b style=&quot;background-color: rgb(255, 255, 255); font-size: 14px; font-family: -apple-system, BlinkMacSystemFont, &amp;quot;Segoe UI&amp;quot;, Roboto, Oxygen, Ubuntu, &amp;quot;Fira Sans&amp;quot;, &amp;quot;Droid Sans&amp;quot;, &amp;quot;Helvetica Neue&amp;quot;, sans-serif; color: rgb(23, 43, 77);&quot;&gt;If unable to capture Customer Signature, enter Title and Name of who you worked with at the Account into the Signee Title and Name fields.&lt;/b&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>Screen</name>
        <label>Screen</label>
        <locationX>1086</locationX>
        <locationY>158</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>Check_Status</targetReference>
        </connector>
        <fields>
            <name>Display_Message</name>
            <fieldText>&lt;p&gt;The appointment is not in Awaiting signature status or does not have an ERP Work Order Id yet, so you cannot capture a signature.&lt;/p&gt;&lt;p&gt;Please click the x to exit the flow.&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>User_Input</name>
        <label>User Input</label>
        <locationX>639</locationX>
        <locationY>509</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>Assign_Work_Order_fields</targetReference>
        </connector>
        <fields>
            <name>Signee_Title</name>
            <dataType>String</dataType>
            <defaultValue>
                <elementReference>WorkOrderRecord.HRCFSL_Signee_Title__c</elementReference>
            </defaultValue>
            <fieldText>Signee Title</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>Signee_Email</name>
            <dataType>String</dataType>
            <defaultValue>
                <elementReference>WorkOrderRecord.HRCFSL_Signee_Email__c</elementReference>
            </defaultValue>
            <fieldText>Signee Email</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>false</isRequired>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>User_Input_Not_Present</name>
        <label>User Input (Not Present)</label>
        <locationX>452</locationX>
        <locationY>624</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>Assign_Not_Present_Fields</targetReference>
        </connector>
        <fields>
            <name>Signee_Disclaimer</name>
            <fieldText>&lt;p&gt;&lt;b&gt;Enter who you spoke with at the Account for the signee. This must be a customer.&lt;/b&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Signee_Title_Not_Present</name>
            <dataType>String</dataType>
            <defaultValue>
                <elementReference>WorkOrderRecord.HRCFSL_Signee_Title__c</elementReference>
            </defaultValue>
            <fieldText>Signee Title</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>Signee_Email_Not_Present</name>
            <dataType>String</dataType>
            <defaultValue>
                <elementReference>WorkOrderRecord.HRCFSL_Signee_Email__c</elementReference>
            </defaultValue>
            <fieldText>Signee Email</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>false</isRequired>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <startElementReference>Invoke_Subflow</startElementReference>
    <status>Active</status>
    <subflows>
        <name>Invoke_Subflow</name>
        <label>Invoke Subflow</label>
        <locationX>176</locationX>
        <locationY>175</locationY>
        <connector>
            <targetReference>Get_Service_Appointment</targetReference>
        </connector>
        <flowName>HRCFSL_FSL_Mobile_Subflow</flowName>
        <inputAssignments>
            <name>Id</name>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>recordId</name>
            <value>
                <elementReference>Id</elementReference>
            </value>
        </inputAssignments>
        <outputAssignments>
            <assignToReference>recordId</assignToReference>
            <name>Id</name>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>Id</assignToReference>
            <name>recordId</name>
        </outputAssignments>
    </subflows>
    <variables>
        <name>childWorkOrder</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>WorkOrder</objectType>
    </variables>
    <variables>
        <name>childWorkOrders</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>WorkOrder</objectType>
    </variables>
    <variables>
        <name>Id</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>recordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>ServiceAppointmentRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>ServiceAppointment</objectType>
    </variables>
    <variables>
        <name>SigneeEmail</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>SigneeName</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>SigneeTitle</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>WorkOrderRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>WorkOrder</objectType>
    </variables>
</Flow>
